name: Continuous Deployment (CD)
 
on: 
  push:
    branches:
      - master
 
jobs:
  deploy:
    runs-on: ubuntu-latest
 
    steps:
    - uses: actions/checkout@v3
    - uses: akhileshns/heroku-deploy@v3.12.12 
      with:
        heroku_api_key: "115f4d4a-4e10-496c-92a4-f8af7293068b"
        heroku_app_name: "forum-api-v2" 
        heroku_email: "suwantosanjaya@uin-suska.ac.id"
    - uses: actions/checkout@v3
    - name: Use Node.js ${{ matrix.node-version }}
      uses: actions/setup-node@v3
      with:
        node-version: ${{ matrix.node-version }}
    - name: npm install migrate and test
      run: |
        npm install
        npm run migrate up
        npm run start
      env:
        PGHOST: ec2-54-173-77-184.compute-1.amazonaws.com
        PGUSER: pemwnkzzbltwai
        PGDATABASE: des8df3jsmp3m6
        PGPASSWORD: f645a4bf153efe67fc7465aa3620489b85d73e6de759a60e48338909156f0340
        PGPORT: 5432